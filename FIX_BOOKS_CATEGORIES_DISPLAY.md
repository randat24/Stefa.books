# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–Ω–∏–≥ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∞ —Å–∞–π—Ç–µ

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–∞ —Å–∞–π—Ç–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–Ω–∏–≥–∏ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏  
**–ü—Ä–∏—á–∏–Ω–∞**: RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º —á–µ—Ä–µ–∑ anon key

## üö® **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑–∞–ª–∞:**

- ‚ùå **API Books**: `{"error":"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–Ω–∏–≥"}`
- ‚ùå **API Categories**: `{"success":false,"error":"–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö"}`

## üéØ **–†–ï–®–ï–ù–ò–ï:**

### **–®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ Supabase**

1. **–û—Ç–∫—Ä–æ–π—Ç–µ**: [Supabase Dashboard](https://supabase.com/dashboard)
2. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤**: SQL Editor
3. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç**: `fix_books_categories_api.sql`

**–ò–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥:**

```sql
-- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ RLS –ø–æ–ª–∏—Ç–∏–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–Ω–∏–≥ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

-- ============================================================================
-- –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï RLS –î–õ–Ø –¢–ê–ë–õ–ò–¶–´ BOOKS
-- ============================================================================

-- –û—Ç–∫–ª—é—á–∞–µ–º RLS –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã books
ALTER TABLE public.books DISABLE ROW LEVEL SECURITY;

-- –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è books
DO $$
DECLARE
    policy_name TEXT;
BEGIN
    FOR policy_name IN 
        SELECT policyname 
        FROM pg_policies 
        WHERE tablename = 'books' AND schemaname = 'public'
    LOOP
        EXECUTE format('DROP POLICY IF EXISTS %I ON public.books', policy_name);
    END LOOP;
END $$;

-- –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è books
CREATE POLICY "books_select_public" ON public.books 
    FOR SELECT USING (true);

CREATE POLICY "books_insert_admin" ON public.books 
    FOR INSERT WITH CHECK (
        EXISTS (
            SELECT 1 FROM public.users 
            WHERE email = auth.email() AND role = 'admin'
        )
    );

-- –í–∫–ª—é—á–∞–µ–º RLS –æ–±—Ä–∞—Ç–Ω–æ
ALTER TABLE public.books ENABLE ROW LEVEL SECURITY;

-- ============================================================================
-- –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï RLS –î–õ–Ø –¢–ê–ë–õ–ò–¶–´ CATEGORIES
-- ============================================================================

-- –û—Ç–∫–ª—é—á–∞–µ–º RLS –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã categories
ALTER TABLE public.categories DISABLE ROW LEVEL SECURITY;

-- –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è categories
DO $$
DECLARE
    policy_name TEXT;
BEGIN
    FOR policy_name IN 
        SELECT policyname 
        FROM pg_policies 
        WHERE tablename = 'categories' AND schemaname = 'public'
    LOOP
        EXECUTE format('DROP POLICY IF EXISTS %I ON public.categories', policy_name);
    END LOOP;
END $$;

-- –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è categories
CREATE POLICY "categories_select_public" ON public.categories 
    FOR SELECT USING (true);

-- –í–∫–ª—é—á–∞–µ–º RLS –æ–±—Ä–∞—Ç–Ω–æ
ALTER TABLE public.categories ENABLE ROW LEVEL SECURITY;
```

### **–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç**

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ API Books
curl https://stefa-books.com.ua/api/books

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API Categories  
curl https://stefa-books.com.ua/api/categories
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ API Books –≤–µ—Ä–Ω–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–Ω–∏–≥
- ‚úÖ API Categories –≤–µ—Ä–Ω–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

### **–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∞–π—Ç**

1. **–û—Ç–∫—Ä–æ–π—Ç–µ**: [https://stefa-books.com.ua](https://stefa-books.com.ua)
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ**: –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ª–∏ –∫–Ω–∏–≥–∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ**: –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –∫–∞—Ç–∞–ª–æ–≥ –∫–Ω–∏–≥
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ**: –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

## üîç **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

### **1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel:**
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`

### **2. –õ–æ–≥–∏ Vercel:**
- Vercel Dashboard ‚Üí Functions ‚Üí View Logs

### **3. –õ–æ–≥–∏ Supabase:**
- Supabase Dashboard ‚Üí Logs

## ‚úÖ **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è RLS –ø–æ–ª–∏—Ç–∏–∫:
- ‚úÖ **–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞**: –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–Ω–∏–≥–∏
- ‚úÖ **–ö–∞—Ç–∞–ª–æ–≥**: –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- ‚úÖ **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏**: –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –º–µ–Ω—é
- ‚úÖ **API**: –í–æ–∑–≤—Ä–∞—â–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –≤–º–µ—Å—Ç–æ –æ—à–∏–±–æ–∫

---

**–í—Ä–µ–º—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 2-3 –º–∏–Ω—É—Ç—ã  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –ü—Ä–æ—Å—Ç–∞—è  
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Å–∞–π—Ç —Å –∫–Ω–∏–≥–∞–º–∏ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏! üöÄ
