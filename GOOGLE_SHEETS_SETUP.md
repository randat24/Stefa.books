# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Sheets –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Google Sheets –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∫–Ω–∏–≥.

## üîß –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ Google Cloud Project

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google Cloud Console](https://console.cloud.google.com/)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
3. –ó–∞–ø–æ–º–Ω–∏—Ç–µ Project ID (–ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –ø–æ–∑–∂–µ)

### 2. –í–∫–ª—é—á–µ–Ω–∏–µ Google Sheets API

1. –í Google Cloud Console –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "APIs & Services" > "Library"
2. –ù–∞–π–¥–∏—Ç–µ "Google Sheets API"
3. –ù–∞–∂–º–∏—Ç–µ "Enable"

### 3. –°–æ–∑–¥–∞–Ω–∏–µ Service Account

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "APIs & Services" > "Credentials"
2. –ù–∞–∂–º–∏—Ç–µ "Create Credentials" > "Service Account"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - **Service account name**: `stefa-books-bot`
   - **Service account ID**: `stefa-books-bot`
   - **Description**: `Bot for Stefa.books Google Sheets integration`
4. –ù–∞–∂–º–∏—Ç–µ "Create and Continue"
5. –ü—Ä–æ–ø—É—Å—Ç–∏—Ç–µ —à–∞–≥–∏ —Å —Ä–æ–ª—è–º–∏ (–Ω–∞–∂–º–∏—Ç–µ "Continue" –∏ "Done")

### 4. –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞ Service Account

1. –í —Å–ø–∏—Å–∫–µ Service Accounts –Ω–∞–π–¥–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "Keys"
4. –ù–∞–∂–º–∏—Ç–µ "Add Key" > "Create new key"
5. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç **JSON**
6. –°–∫–∞—á–∞–π—Ç–µ —Ñ–∞–π–ª (—Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ!)

### 5. –°–æ–∑–¥–∞–Ω–∏–µ Google Sheets —Ç–∞–±–ª–∏—Ü—ã

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google Sheets](https://sheets.google.com)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É
3. –ù–∞–∑–æ–≤–∏—Ç–µ –µ—ë "Stefa Books Database"
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ ID —Ç–∞–±–ª–∏—Ü—ã –∏–∑ URL:
   ```
   https://docs.google.com/spreadsheets/d/1fFGQxVE8gmgNZRzheFz4sY2gyyufrMVSAQ0JhKvDZ7I/edit
                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                                          –≠—Ç–æ –≤–∞—à SPREADSHEET_ID
   ```

### 6. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ Service Account

**–û—á–µ–Ω—å –≤–∞–∂–Ω–æ!** Service Account –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–µ:

1. –í Google Sheets –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" (Share)
2. –í –ø–æ–ª–µ email –≤—Å—Ç–∞–≤—å—Ç–µ email Service Account –∏–∑ JSON —Ñ–∞–π–ª–∞
3. Email –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫: `stefa-books-bot@your-project-id.iam.gserviceaccount.com`
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∞ "–†–µ–¥–∞–∫—Ç–æ—Ä" (Editor)
5. –°–Ω–∏–º–∏—Ç–µ –≥–∞–ª–æ—á–∫—É "–£–≤–µ–¥–æ–º–∏—Ç—å –ª—é–¥–µ–π"
6. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"

### 7. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Ç–∫—Ä–æ–π—Ç–µ —Å–∫–∞—á–∞–Ω–Ω—ã–π JSON —Ñ–∞–π–ª –∏ –∏–∑–≤–ª–µ–∫–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ:

```json
{
  "client_email": "stefa-books-bot@your-project-id.iam.gserviceaccount.com",
  "private_key": "-----BEGIN PRIVATE KEY-----\\nMIIE...\\n-----END PRIVATE KEY-----\\n"
}
```

–û–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª—ã `.env.local` –∏ `.env.production`:

```env
# Google Sheets Configuration
GOOGLE_SHEETS_CLIENT_EMAIL=stefa-books-bot@your-project-id.iam.gserviceaccount.com
GOOGLE_SHEETS_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\\n–í–ê–®_–ü–†–ò–í–ê–¢–ù–´–ô_–ö–õ–Æ–ß\\n-----END PRIVATE KEY-----\\n"
GOOGLE_SHEETS_SPREADSHEET_ID=–≤–∞—à_spreadsheet_id
```

**–í–∞–∂–Ω–æ**: –í private_key –≤—Å–µ —Å–∏–º–≤–æ–ª—ã `\\n` –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è –∫–∞–∫ –µ—Å—Ç—å - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ API endpoints:

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```bash
GET /api/sync
```

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∫–Ω–∏–≥ –≤ Supabase –∏ Google Sheets.

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Google Sheets
```bash
POST /api/sync
Content-Type: application/json

{
  "action": "backup_to_sheets"
}
```

–°–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –≤—Å–µ—Ö –∫–Ω–∏–≥ –∏–∑ Supabase –≤ Google Sheets.

### –ò–º–ø–æ—Ä—Ç –∏–∑ Google Sheets
```bash
POST /api/sync
Content-Type: application/json

{
  "action": "import_from_sheets"
}
```

–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ Google Sheets –≤ Supabase (–∑–∞–º–µ–Ω—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ).

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã

Google Sheets —Ç–∞–±–ª–∏—Ü–∞ –±—É–¥–µ—Ç –∏–º–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏:

| –ö–æ–ª–æ–Ω–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|---------|----------|--------|
| id | UUID –∫–Ω–∏–≥–∏ | `123e4567-e89b-12d3-a456-426614174000` |
| code | –ö–æ–¥ –∫–Ω–∏–≥–∏ | `MD-001` |
| title | –ù–∞–∑–≤–∞–Ω–∏–µ | `–¢–∞—î–º–Ω–∏—Ü—ñ —Å—Ç–∞—Ä–æ–≥–æ –∑–∞–º–∫—É` |
| author | –ê–≤—Ç–æ—Ä | `–í–æ–ª–æ–¥–∏–º–∏—Ä –í–∏–Ω–Ω–∏—á–µ–Ω–∫–æ` |
| category | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | `–ú—ñ—Å—Ç–∏–∫–∞ –¥–ª—è –¥—ñ—Ç–µ–π` |
| subcategory | –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è | *(–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π)* |
| description | –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ | *—Ç–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è* |
| short_description | –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ | *–∫—Ä–∞—Ç–∫–∏–π —Ç–µ–∫—Å—Ç* |
| isbn | ISBN –Ω–æ–º–µ—Ä | `978-966-000-000-0` |
| pages | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü | `192` |
| age_range | –í–æ–∑—Ä–∞—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞ | `8+` |
| language | –Ø–∑—ã–∫ | `Ukrainian` |
| publisher | –ò–∑–¥–∞—Ç–µ–ª—å | *–Ω–∞–∑–≤–∞–Ω–∏–µ –∏–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞* |
| publication_year | –ì–æ–¥ –∏–∑–¥–∞–Ω–∏—è | `2023` |
| cover_url | –°—Å—ã–ª–∫–∞ –Ω–∞ –æ–±–ª–æ–∂–∫—É | `/images/books/cover.jpg` |
| status | –°—Ç–∞—Ç—É—Å –∫–Ω–∏–≥–∏ | `available`, `issued`, `reserved`, `lost` |
| available | –î–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ | `TRUE` / `FALSE` |
| qty_total | –í—Å–µ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ | `1` |
| qty_available | –î–æ—Å—Ç—É–ø–Ω–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ | `1` |
| price_uah | –¶–µ–Ω–∞ –≤ –≥—Ä–∏–≤–Ω–∞—Ö | `294` |
| location | –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ | `–≤—É–ª. –ú–∞—Ä—ñ—É–ø–æ–ª—å—Å—å–∫–∞ 13/2, –ú–∏–∫–æ–ª–∞—ó–≤` |
| rating | –†–µ–π—Ç–∏–Ω–≥ | `4.6` |
| rating_count | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ü–µ–Ω–æ–∫ | `156` |
| badges | –ë–µ–π–¥–∂–∏ | `–í —Ç—Ä–µ–Ω–¥—ñ, –ù–æ–≤–µ` (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) |
| tags | –¢–µ–≥–∏ | `–º—ñ—Å—Ç–∏–∫–∞ –¥–ª—è –¥—ñ—Ç–µ–π, –≤ —Ç—Ä–µ–Ω–¥—ñ` (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) |
| created_at | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è | `2025-08-28T09:51:31.435+00:00` |
| updated_at | –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | `2025-08-28T10:59:18.535652+00:00` |

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–π —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏

```bash
curl -X POST "https://your-domain.com/api/sync" \
  -H "Content-Type: application/json" \
  -d '{"action":"backup_to_sheets"}'
```

### 2. –ò–º–ø–æ—Ä—Ç –Ω–æ–≤—ã—Ö –∫–Ω–∏–≥ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã

1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ Google Sheets —Ç–∞–±–ª–∏—Ü—É (–¥–æ–±–∞–≤—å—Ç–µ/–∏–∑–º–µ–Ω–∏—Ç–µ –∫–Ω–∏–≥–∏)
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∏–º–ø–æ—Ä—Ç:

```bash
curl -X POST "https://your-domain.com/api/sync" \
  -H "Content-Type: application/json" \
  -d '{"action":"import_from_sheets"}'
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```bash
curl "https://your-domain.com/api/sync"
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ** `.env.local` —Ñ–∞–π–ª –≤ git
- **–•—Ä–∞–Ω–∏—Ç–µ JSON –∫–ª—é—á** –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ
- **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø** –∫ Google Sheets —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º –ª—é–¥—è–º
- **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ** –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

## ‚ùó –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ "The caller does not have permission"

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Service Account email –¥–æ–±–∞–≤–ª–µ–Ω –≤ Google Sheets —Å –ø—Ä–∞–≤–∞–º–∏ "–†–µ–¥–∞–∫—Ç–æ—Ä"
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ GOOGLE_SHEETS_SPREADSHEET_ID –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Google Sheets API –≤–∫–ª—é—á–µ–Ω –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ

### –û—à–∏–±–∫–∞ "Invalid private key"

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ private_key —Å–æ–¥–µ—Ä–∂–∏—Ç `\\n` (–¥–≤–æ–π–Ω–æ–π —Å–ª–µ—à + n)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–ª—é—á –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `-----BEGIN PRIVATE KEY-----`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤ –≤ –Ω–∞—á–∞–ª–µ/–∫–æ–Ω—Ü–µ –∫–ª—é—á–∞

### –û—à–∏–±–∫–∞ "Sheet not found"

1. –¢–∞–±–ª–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ª–∏—Å—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "Books"
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É Service Account –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SPREADSHEET_ID –≤ URL —Ç–∞–±–ª–∏—Ü—ã

## ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

–í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å cron job –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π:

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00
0 2 * * * curl -X POST "https://your-domain.com/api/sync" -H "Content-Type: application/json" -d '{"action":"backup_to_sheets"}'
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Service Account –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞: 28.08.2025*