# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–ø–∏—Å–∫–∏

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. **–£–¥–∞–ª–µ–Ω—ã –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã** - –∫–æ–¥ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏ `users` –∏ `subscription_requests`
2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω SubscriptionService** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É `users` –≤–º–µ—Å—Ç–æ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π `subscriptions`
3. **–û–±–Ω–æ–≤–ª–µ–Ω webhook** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ –∏ –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
4. **–£–ø—Ä–æ—â–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - —É–±—Ä–∞–Ω—ã —Å—Å—ã–ª–∫–∏ –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π

### 1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–í Netlify Dashboard:**
- `MONOBANK_TOKEN=uSjulrJT5jqGnzy8lSQoasq04GRtKMo0myvxJk5D0EKY`
- `NEXT_PUBLIC_SITE_URL=https://stefa-books.com.ua`

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –≤ Monobank

- URL: `https://stefa-books.com.ua/api/payments/monobank/webhook`
- –°–æ–±—ã—Ç–∏—è: `invoice.status.changed`

### 3. –î–µ–ø–ª–æ–π –∫–æ–¥–∞

```bash
git add .
git commit -m "feat: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Monobank —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –ë–î"
git push origin main
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `https://stefa-books.com.ua/subscribe`
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É, –≤—ã–±–µ—Ä–∏—Ç–µ "–û–Ω–ª–∞–π–Ω –æ–ø–ª–∞—Ç–∞"
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—ã –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ Monobank
4. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –í Supabase SQL Editor:

```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É
SELECT id, name, email, plan, payment_method, status, created_at 
FROM subscription_requests 
ORDER BY created_at DESC 
LIMIT 10;

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
SELECT id, name, email, subscription_type, subscription_start, subscription_end, status 
FROM users 
WHERE subscription_type IS NOT NULL
ORDER BY created_at DESC 
LIMIT 10;
```

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `subscription_requests`
- `id` - UUID –∑–∞—è–≤–∫–∏
- `name`, `email`, `phone` - –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `plan` - mini/maxi/premium
- `payment_method` - monobank/online/cash
- `status` - pending/approved/rejected/completed

### –¢–∞–±–ª–∏—Ü–∞ `users`
- `id` - UUID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `name`, `email`, `phone` - –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `subscription_type` - mini/maxi/premium
- `subscription_start`, `subscription_end` - –¥–∞—Ç—ã –ø–æ–¥–ø–∏—Å–∫–∏
- `status` - active/inactive/suspended

## üéØ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –ø–æ–¥–ø–∏—Å–∫–∏
2. **–ó–∞—è–≤–∫–∞** —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `subscription_requests` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`
3. **–ü–ª–∞—Ç–µ–∂** —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ Monobank
4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –æ–ø–ª–∞—Ç—É
5. **Monobank** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
6. **Webhook** –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É:
   - –û–±–Ω–æ–≤–ª—è–µ—Ç `subscription_requests.status = 'completed'`
   - –°–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ `users`
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `subscription_type`, `subscription_start`, `subscription_end`

## üö® –í–∞–∂–Ω–æ

- **–ù–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã** - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
- **RLS –ø–æ–ª–∏—Ç–∏–∫–∏** —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è `subscription_requests`
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `logger`
- **–í–∞–ª–∏–¥–∞—Ü–∏—è** –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Zod —Å—Ö–µ–º—ã

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Netlify Dashboard
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook –≤ Monobank
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤ Supabase

---

**–ì–æ—Ç–æ–≤–æ!** üéâ –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–∫–∏ —Å Monobank –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.
