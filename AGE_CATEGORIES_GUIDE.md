# üìö –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

## üéØ –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `age_categories`
- **–ù–∞–π–º–µ–Ω—à—ñ (0-2 —Ä–æ–∫–∏)** - –∫–Ω–∏–≥–∏ –¥–ª—è —Å–∞–º—ã—Ö –º–∞–ª–µ–Ω—å–∫–∏—Ö
- **–î–æ—à–∫—ñ–ª—å–Ω–∏–π –≤—ñ–∫ (3-5 —Ä–æ–∫—ñ–≤)** - –¥–æ—à–∫–æ–ª—å–Ω—ã–µ –∫–Ω–∏–≥–∏
- **–ú–æ–ª–æ–¥—à–∏–π –≤—ñ–∫ (6-8 —Ä–æ–∫—ñ–≤)** - –º–ª–∞–¥—à–∏–π —à–∫–æ–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç
- **–°–µ—Ä–µ–¥–Ω—ñ–π –≤—ñ–∫ (9-12 —Ä–æ–∫—ñ–≤)** - —Å—Ä–µ–¥–Ω–∏–π —à–∫–æ–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç
- **–ü—ñ–¥–ª—ñ—Ç–∫–æ–≤–∏–π –≤—ñ–∫ (13-16 —Ä–æ–∫—ñ–≤)** - –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤—ã–π –≤–æ–∑—Ä–∞—Å—Ç
- **–î–æ—Ä–æ—Å–ª—ñ (17+ —Ä–æ–∫—ñ–≤)** - –≤–∑—Ä–æ—Å–ª—ã–µ –∫–Ω–∏–≥–∏
- **–í—Å—ñ –≤—ñ–∫–∏** - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –∫–Ω–∏–≥–∏

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ `age_category_id` –≤ —Ç–∞–±–ª–∏—Ü—É `books`
- –û–±–Ω–æ–≤–ª–µ–Ω VIEW `books_with_authors` —Å –ø–æ–ª—è–º–∏ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞

### 3. –ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `AgeCategoryBadge` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `AgeCategoryFilter` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- API endpoint `/api/age-categories` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
# –í Supabase Dashboard ‚Üí SQL Editor –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
# supabase/migrations/010_add_age_categories.sql
```

### 2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–Ω–∏–≥
```bash
node scripts/populate-age-categories.js
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```bash
node verify-database-fix.js
```

## üìñ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
```tsx
import { AgeCategoryBadge } from '@/components/ui/AgeCategoryBadge';

// –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
<AgeCategoryBadge 
  ageRange={book.age_range}
  ageCategoryName={book.age_category_name}
  variant="compact"
/>

// –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
<AgeCategoryBadge 
  ageRange={book.age_range}
  ageCategoryName={book.age_category_name}
  variant="detailed"
/>
```

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
```tsx
import { AgeCategoryFilter } from '@/components/filters/AgeCategoryFilter';

<AgeCategoryFilter
  selectedAgeCategories={selectedAges}
  onAgeCategoriesChange={setSelectedAges}
/>
```

### API –∑–∞–ø—Ä–æ—Å—ã
```typescript
// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
const { data } = await supabase
  .from('age_categories')
  .select('*')
  .eq('is_active', true)
  .order('sort_order');

// –ü–æ–ª—É—á–∏—Ç—å –∫–Ω–∏–≥–∏ —Å –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
const { data } = await supabase
  .from('books_with_authors')
  .select('*')
  .eq('age_category_id', categoryId);
```

## üé® –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è

### –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- **–ù–∞–π–º–µ–Ω—à—ñ (0-2)**: –†–æ–∑–æ–≤—ã–π (`bg-pink-100 text-pink-700`)
- **–î–æ—à–∫—ñ–ª—å–Ω–∏–π (3-5)**: –§–∏–æ–ª–µ—Ç–æ–≤—ã–π (`bg-purple-100 text-purple-700`)
- **–ú–æ–ª–æ–¥—à–∏–π (6-8)**: –°–∏–Ω–∏–π (`bg-blue-100 text-blue-700`)
- **–°–µ—Ä–µ–¥–Ω—ñ–π (9-12)**: –ó–µ–ª–µ–Ω—ã–π (`bg-green-100 text-green-700`)
- **–ü—ñ–¥–ª—ñ—Ç–∫–æ–≤–∏–π (13-16)**: –û—Ä–∞–Ω–∂–µ–≤—ã–π (`bg-orange-100 text-orange-700`)
- **–î–æ—Ä–æ—Å–ª—ñ (17+)**: –ö—Ä–∞—Å–Ω—ã–π (`bg-red-100 text-red-700`)
- **–í—Å—ñ –≤—ñ–∫–∏**: –°–µ—Ä—ã–π (`bg-neutral-100 text-neutral-600`)

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
```sql
INSERT INTO age_categories (name, slug, description, min_age, max_age, sort_order, is_active) 
VALUES ('–ù–æ–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è', 'nova-kategoriya', '–û–ø–∏—Å', 5, 10, 7, true);
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
```sql
UPDATE age_categories 
SET name = '–û–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞–∑–≤–∞', description = '–ù–æ–≤–∏–π –æ–ø–∏—Å'
WHERE slug = 'nova-kategoriya';
```

### –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
```sql
UPDATE age_categories 
SET is_active = false 
WHERE slug = 'nova-kategoriya';
```

## üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
```sql
SELECT 
  ac.name as age_category,
  COUNT(b.id) as book_count,
  AVG(b.rating) as avg_rating
FROM age_categories ac
LEFT JOIN books b ON ac.id = b.age_category_id
WHERE b.category != 'subscription-request'
GROUP BY ac.id, ac.name, ac.sort_order
ORDER BY ac.sort_order;
```

### –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
```sql
SELECT 
  ac.name,
  COUNT(b.id) as book_count,
  COUNT(r.id) as rental_count
FROM age_categories ac
LEFT JOIN books b ON ac.id = b.age_category_id
LEFT JOIN rentals r ON b.id = r.book_id
WHERE b.category != 'subscription-request'
GROUP BY ac.id, ac.name
ORDER BY rental_count DESC;
```

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: –í–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∏ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
```bash
node scripts/populate-age-categories.js
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –∫–Ω–∏–≥
**–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ç–µ –ª–æ–≥–∏–∫—É –≤ `scripts/populate-age-categories.js`

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ TypeScript
**–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ç–µ —Ç–∏–ø—ã –≤ `src/lib/database.types.ts`

## üìà –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è** - ML –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
2. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** - —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–∑—Ä–∞—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º –≥—Ä—É–ø–ø–∞–º
4. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
5. **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏** - —É–º–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫–Ω–∏–≥ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í–æ–∑—Ä–∞—Å—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–Ω–∏–≥–∏
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ø–æ–∏—Å–∫ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
