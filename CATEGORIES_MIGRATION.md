# –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –Ω–æ–≤–æ–π –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –ø—Ä–æ–µ–∫—Ç Stefa.books.

## üéØ –¶–µ–ª—å –º–∏–≥—Ä–∞—Ü–∏–∏

–ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç –ø—Ä–æ—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ –∫ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
- –ö–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É (–ù–∞–π–º–µ–Ω—à—ñ, –î–æ—à–∫—ñ–ª—å–Ω–∏–π –≤—ñ–∫, –∏ —Ç.–¥.)
- –ö–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ –∂–∞–Ω—Ä–∞–º (–ö–∞–∑–∫–∏, –ü—ñ–∑–Ω–∞–≤–∞–ª—å–Ω—ñ, –î–µ—Ç–µ–∫—Ç–∏–≤, –∏ —Ç.–¥.)
- –ö–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è –¥–æ—Ä–æ—Å–ª—ã—Ö (–ü—Å–∏—Ö–æ–ª–æ–≥—ñ—è, –°—É—á–∞—Å–Ω–∞ –ø—Ä–æ–∑–∞)
- –î—Ä–µ–≤–æ–≤–∏–¥–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
- –ò–∫–æ–Ω–æ–∫ –∏ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π

## üìã –®–∞–≥–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL-–º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π:

```bash
# –í Supabase Dashboard –∏–ª–∏ —á–µ—Ä–µ–∑ CLI
supabase migration up --file supabase/migrations/001_create_categories.sql
```

–≠—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞—Å—Ç:
- –¢–∞–±–ª–∏—Ü—É `categories` —Å –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- –î–æ–±–∞–≤–∏—Ç –ø–æ–ª—è `category_id` –∏ `age_category_id` –≤ —Ç–∞–±–ª–∏—Ü—É `books`
- –°–æ–∑–¥–∞—Å—Ç –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –î–æ–±–∞–≤–∏—Ç RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –°–æ–∑–¥–∞—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–µ—Ä–µ–≤–æ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –ó–∞–ø–æ–ª–Ω–∏—Ç –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ

### 2. –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
npm install dotenv @supabase/supabase-js

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
node scripts/migrate-categories.js
```

–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç:
- –ú–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ä—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –Ω–æ–≤—ã–µ ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –∫–Ω–∏–≥ —Å –Ω–æ–≤—ã–º–∏ —Å–≤—è–∑—è–º–∏
- –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

#### 3.1 –ù–æ–≤—ã–µ —Ç–∏–ø—ã –∏ API

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏:

```typescript
// –ù–æ–≤—ã–µ —Ç–∏–ø—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π
import type { Category, CategoryTree, CategoryBreadcrumb } from '@/lib/supabase';
import { fetchCategoryTree, fetchCategories } from '@/lib/api/categories';

// –ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∫–Ω–∏–≥
import { fetchBooks } from '@/lib/api/books';

const books = await fetchBooks({
  category_id: 'uuid-–∂–∞–Ω—Ä–∞',
  age_category_id: 'uuid-–≤–æ–∑—Ä–∞—Å—Ç–∞',
  available_only: true
});
```

#### 3.2 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ç–∞–ª–æ–≥–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–∞—Ç–∞–ª–æ–≥–∞:

```tsx
import { CategoryCatalog } from '@/components/catalog/CategoryCatalog';

export default function CatalogPage() {
  return (
    <div className="container mx-auto py-8">
      <CategoryCatalog 
        showBooksCount={true}
        onCategorySelect={(category) => {
          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
          router.push(`/books?category_id=${category.id}`);
        }}
      />
    </div>
  );
}
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### 4.1 –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ –∫–Ω–∏–≥

–û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

```tsx
// –í SimpleSearch –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
const handleCategoryFilter = (categoryId: string, type: 'genre' | 'age') => {
  const params = new URLSearchParams(searchParams);
  
  if (type === 'genre') {
    params.set('category_id', categoryId);
  } else {
    params.set('age_category_id', categoryId);
  }
  
  router.push(`/books?${params.toString()}`);
};
```

#### 4.2 URL-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã

–ù–æ–≤—ã–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `category_id` - ID –∂–∞–Ω—Ä–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `age_category_id` - ID –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏  
- `category` - —Å—Ç–∞—Ä—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

–û–±–Ω–æ–≤–∏—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

```tsx
// –í –∞–¥–º–∏–Ω-—Ñ–æ—Ä–º–∞—Ö –¥–æ–±–∞–≤—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π
const [categories, setCategories] = useState<Category[]>([]);
const [ageCategories, setAgeCategories] = useState<Category[]>([]);

useEffect(() => {
  // –ó–∞–≥—Ä—É–∑–∫–∞ –∂–∞–Ω—Ä–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
  fetchChildCategories('genre-parent-id').then(response => {
    if (response.success) setCategories(response.data);
  });
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π  
  fetchChildCategories('age-parent-id').then(response => {
    if (response.success) setAgeCategories(response.data);
  });
}, []);
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ API

```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ API –∫–∞—Ç–µ–≥–æ—Ä–∏–π
curl "http://localhost:3000/api/categories?tree=true"
curl "http://localhost:3000/api/categories?parent_id=genre-uuid"

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–Ω–∏–≥ —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
curl "http://localhost:3000/api/books?category_id=fairy-tales-uuid"
curl "http://localhost:3000/api/books?age_category_id=preschool-uuid"
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ UI

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–∞—Ç–∞–ª–æ–≥–∞: `/books`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –Ω–æ–≤—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—Ç–∞—Ä—ã–µ —Å—Å—ã–ª–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ CategoryCatalog

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–π
SELECT 
  b.title,
  c.name as genre,
  ac.name as age_group
FROM books b
LEFT JOIN categories c ON b.category_id = c.id  
LEFT JOIN categories ac ON b.age_category_id = ac.id
LIMIT 10;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
SELECT 
  c.name,
  COUNT(b.id) as books_count,
  COUNT(CASE WHEN b.available THEN 1 END) as available_count
FROM categories c
LEFT JOIN books b ON (b.category_id = c.id OR b.age_category_id = c.id)
WHERE c.parent_id IS NOT NULL
GROUP BY c.id, c.name
ORDER BY books_count DESC;
```

## üîß –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:

```sql
-- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –ø–æ–ª—è category –∏–∑ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
UPDATE books 
SET category = (
  SELECT c.name 
  FROM categories c 
  WHERE c.id = books.category_id
)
WHERE category_id IS NOT NULL;

-- –£–¥–∞–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
-- ALTER TABLE books DROP COLUMN category_id;
-- ALTER TABLE books DROP COLUMN age_category_id;
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ:
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ —Å JOIN
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–∏—Å–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –ò–∫–æ–Ω–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

–ò–∑–º–µ–Ω–∏—Ç–µ –∏–∫–æ–Ω–∫–∏ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `getDefaultCategoryIcon()` –≤ `src/lib/types/categories.ts`:

```typescript
const iconMap: Record<string, string> = {
  'fairy-tales': 'üßö‚Äç‚ôÄÔ∏è',  // –ò–∑–º–µ–Ω–∏—Ç—å –∏–∫–æ–Ω–∫—É
  'detective': 'üïµÔ∏è',      // –ò–ª–∏ —ç—Ç—É
  // ...
};
```

### –¶–≤–µ—Ç–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

–û–±–Ω–æ–≤–∏—Ç–µ —Ü–≤–µ—Ç–∞ –≤ `getDefaultCategoryColor()`:

```typescript
const colorMap: Record<string, string> = {
  'fairy-tales': '#FF6B9D',  // –†–æ–∑–æ–≤—ã–π –¥–ª—è —Å–∫–∞–∑–æ–∫
  'detective': '#2563EB',    // –°–∏–Ω–∏–π –¥–ª—è –¥–µ—Ç–µ–∫—Ç–∏–≤–æ–≤
  // ...
};
```

## ‚ùì –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ë–î –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é  
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–±–ª–∏—Ü–µ categories
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã

---

**–í–∞–∂–Ω–æ**: –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –º–∏–≥—Ä–∞—Ü–∏–∏!