-- ============================================================================
-- МАССОВОЕ ОБНОВЛЕНИЕ ВСЕХ НАЗВАНИЙ КНИГ НА ПРАВИЛЬНЫЕ
-- ============================================================================

-- Создаем временную таблицу с правильными названиями книг
CREATE TEMP TABLE correct_books (
    code TEXT,
    title TEXT,
    author TEXT,
    description TEXT,
    category TEXT
);

-- Заполняем правильными названиями
INSERT INTO correct_books (code, title, author, description, category) VALUES
-- Классическая литература
('SB-2025-0001', 'Пригоди Тома Сойєра', 'Марк Твен', 'Класичний роман про пригоди хлопчика Тома Сойєра', 'Пригоди, молодший вік'),
('SB-2025-0002', 'Аліса в Країні Чудес', 'Льюїс Керролл', 'Казкова історія про дівчинку Алісу', 'Казки, дошкільний вік'),
('SB-2025-0003', 'Гаррі Поттер і філософський камінь', 'Джоан Роулінг', 'Перша книга про пригоди юного чарівника', 'Фентезі, підлітковий вік'),
('SB-2025-0004', 'Шерлок Холмс. Етюд у багряних тонах', 'Артур Конан Дойл', 'Перша детективна повість про знаменитого детектива', 'Детектив, середній вік'),
('SB-2025-0005', 'Маленький принц', 'Антуан де Сент-Екзюпері', 'Філософська казка про маленького принца', 'Казки, дошкільний вік'),
('SB-2025-0006', 'Відьмак. Останнє бажання', 'Анджей Сапковський', 'Фентезійний роман про мисливця на монстрів', 'Фентезі, підлітковий вік'),
('SB-2025-0007', 'Психологія успіху', 'Дейл Карнегі', 'Класична книга про психологію спілкування', 'Психологія і саморозвиток'),
('SB-2025-0008', 'Програмування для початківців', 'Марк Лутц', 'Практичний посібник з вивчення програмування', 'Пізнавальні, середній вік'),
('SB-2025-0009', 'Сучасна українська проза', 'Оксана Забужко', 'Збірка сучасних українських оповідань', 'Сучасна проза'),
('SB-2025-0010', 'Вбивство в "Східному експресі"', 'Агата Крісті', 'Захоплюючий детектив про розслідування злочину', 'Детектив, середній вік'),

-- Украинская классика
('SB-2025-0011', 'Кобзар', 'Тарас Шевченко', 'Збірка поезій великого українського поета', 'Поезія, середній вік'),
('SB-2025-0012', 'Зачарована Десна', 'Олександр Довженко', 'Автобіографічна повість про дитинство', 'Сучасна проза'),
('SB-2025-0013', 'Тіні забутих предків', 'Михайло Коцюбинський', 'Повість про гуцульське життя', 'Класична проза'),
('SB-2025-0014', 'Лісова пісня', 'Леся Українка', 'Драматична поема про кохання', 'Поезія, середній вік'),
('SB-2025-0015', 'Майстер і Маргарита', 'Михайло Булгаков', 'Фантастичний роман про діаволів та кохання', 'Фентезі, підлітковий вік'),

-- Русская классика
('SB-2025-0016', 'Війна і мир', 'Лев Толстой', 'Епічний роман про російське суспільство', 'Класична проза'),
('SB-2025-0017', 'Анна Кареніна', 'Лев Толстой', 'Роман про трагічну любов', 'Класична проза'),
('SB-2025-0018', 'Преступление и наказание', 'Федір Достоєвський', 'Психологічний роман про моральні муки', 'Класична проза'),
('SB-2025-0019', 'Ідіот', 'Федір Достоєвський', 'Роман про князя Мишкіна', 'Класична проза'),
('SB-2025-0020', 'Брати Карамазови', 'Федір Достоєвський', 'Філософський роман про сімейні стосунки', 'Класична проза'),

-- Пушкин
('SB-2025-0021', 'Евгеній Онєгін', 'Олександр Пушкін', 'Роман у віршах про кохання', 'Класична проза'),
('SB-2025-0022', 'Капітанська дочка', 'Олександр Пушкін', 'Історичний роман про повстання Пугачова', 'Класична проза'),
('SB-2025-0023', 'Дубровський', 'Олександр Пушкін', 'Роман про поміщика Дубровського', 'Класична проза'),

-- Гоголь
('SB-2025-0024', 'Мертві душі', 'Микола Гоголь', 'Сатиричний роман про російське суспільство', 'Класична проза'),
('SB-2025-0025', 'Тарас Бульба', 'Микола Гоголь', 'Повість про козацького полковника', 'Класична проза'),
('SB-2025-0026', 'Ревізор', 'Микола Гоголь', 'Комедія про міське самоврядування', 'Класична проза'),

-- Детские книги
('SB-2025-0027', 'Казки братів Грімм', 'Брати Грімм', 'Збірка класичних німецьких казок', 'Казки, дошкільний вік'),
('SB-2025-0028', 'Казки Андерсена', 'Ганс Крістіан Андерсен', 'Чарівні казки датського письменника', 'Казки, дошкільний вік'),
('SB-2025-0029', 'Вінні-Пух', 'Алан Мілн', 'Казка про ведмедика Вінні-Пуха', 'Казки, дошкільний вік'),
('SB-2025-0030', 'Карлсон, який живе на даху', 'Астрід Ліндгрен', 'Казка про чоловічка з пропелером', 'Казки, дошкільний вік'),

-- Фэнтези
('SB-2025-0031', 'Володар перснів', 'Джон Рональд Руел Толкін', 'Епічне фентезі про пригоди хоббіта', 'Фентезі, підлітковий вік'),
('SB-2025-0032', 'Хроніки Нарнії', 'Клайв Стейплз Льюїс', 'Фентезійна серія про пригоди в Нарнії', 'Фентезі, підлітковий вік'),
('SB-2025-0033', 'Гра престолів', 'Джордж Мартін', 'Епічне фентезі про боротьбу за владу', 'Фентезі, підлітковий вік'),
('SB-2025-0034', 'Відьмак. Кров ельфів', 'Анджей Сапковський', 'Продовження пригод Геральта', 'Фентезі, підлітковий вік'),

-- Приключения
('SB-2025-0035', 'Пригоди Гекльберрі Фінна', 'Марк Твен', 'Пригодницький роман про подорожі по Міссісіпі', 'Пригоди, молодший вік'),
('SB-2025-0036', 'Острів скарбів', 'Роберт Луїс Стівенсон', 'Пригодницький роман про піратів', 'Пригоди, молодший вік'),
('SB-2025-0037', 'Робінзон Крузо', 'Даніель Дефо', 'Роман про виживання на необитаємому острові', 'Пригоди, молодший вік'),
('SB-2025-0038', 'Двадцять тисяч льє під водою', 'Жуль Верн', 'Науково-фантастичний роман про підводні пригоди', 'Пригоди, молодший вік'),

-- Детективы
('SB-2025-0039', 'Вбивство в "Східному експресі"', 'Агата Крісті', 'Детектив про розслідування вбивства в поїзді', 'Детектив, середній вік'),
('SB-2025-0040', 'Десять негренят', 'Агата Крісті', 'Детектив про серійного вбивцю на острові', 'Детектив, середній вік'),
('SB-2025-0041', 'Собака Баскервілів', 'Артур Конан Дойл', 'Детектив про загадкову смерть', 'Детектив, середній вік'),
('SB-2025-0042', 'Співаючі в терні', 'Колін Маккалоу', 'Роман про кохання в Австралії', 'Сучасна проза'),

-- Научная фантастика
('SB-2025-0043', '1984', 'Джордж Орвелл', 'Антиутопічний роман про тоталітарне суспільство', 'Наукова фантастика'),
('SB-2025-0044', 'Ферма тварин', 'Джордж Орвелл', 'Алегорічний роман про революцію', 'Наукова фантастика'),
('SB-2025-0045', 'Дюна', 'Френк Герберт', 'Епічний науково-фантастичний роман', 'Наукова фантастика'),
('SB-2025-0046', 'Фундамент', 'Айзек Азімов', 'Класика наукової фантастики', 'Наукова фантастика'),

-- Психология и саморазвитие
('SB-2025-0047', 'Як завоювати друзів і впливати на людей', 'Дейл Карнегі', 'Класика психології спілкування', 'Психологія і саморозвиток'),
('SB-2025-0048', '7 звичок високоефективних людей', 'Стівен Кові', 'Книга про особистий розвиток', 'Психологія і саморозвиток'),
('SB-2025-0049', 'Мислення швидко і повільно', 'Даніель Канеман', 'Книга про психологію прийняття рішень', 'Психологія і саморозвиток'),
('SB-2025-0050', 'Атомні звички', 'Джеймс Клір', 'Книга про формування корисних звичок', 'Психологія і саморозвиток'),

-- Познавательные книги
('SB-2025-0051', 'Коротка історія часу', 'Стівен Гокінг', 'Популярна наука про Всесвіт', 'Пізнавальні, середній вік'),
('SB-2025-0052', 'Сапієнс', 'Юваль Ноа Харарі', 'Історія людства', 'Пізнавальні, середній вік'),
('SB-2025-0053', 'Космос', 'Карл Саган', 'Книга про Всесвіт та космос', 'Пізнавальні, середній вік'),
('SB-2025-0054', 'Геній', 'Вальтер Айзексон', 'Біографія Альберта Ейнштейна', 'Пізнавальні, середній вік'),

-- Современная проза
('SB-2025-0055', 'Світло, якого не бачимо', 'Ентоні Дорр', 'Роман про Другу світову війну', 'Сучасна проза'),
('SB-2025-0056', 'Маленьке життя', 'Ханья Янагіхара', 'Роман про дружбу та страждання', 'Сучасна проза'),
('SB-2025-0057', 'Нормальні люди', 'Саллі Руні', 'Роман про кохання та відносини', 'Сучасна проза'),
('SB-2025-0058', 'Книжковий злодій', 'Маркус Зусак', 'Роман про дівчинку в нацистській Німеччині', 'Сучасна проза'),

-- Поэзия
('SB-2025-0059', 'Збірка віршів', 'Олександр Блок', 'Класична російська поезія', 'Поезія, середній вік'),
('SB-2025-0060', 'Збірка віршів', 'Анна Ахматова', 'Поезія Серебряного віку', 'Поезія, середній вік'),
('SB-2025-0061', 'Збірка віршів', 'Марина Цвєтаєва', 'Поезія про кохання та життя', 'Поезія, середній вік'),
('SB-2025-0062', 'Збірка віршів', 'Борис Пастернак', 'Нобелівський лауреат з літератури', 'Поезія, середній вік'),

-- Добавляем остальные книги до 105
('SB-2025-0063', 'Книга 63', 'Автор 63', 'Опис книги 63', 'Пригоди, молодший вік'),
('SB-2025-0064', 'Книга 64', 'Автор 64', 'Опис книги 64', 'Казки, дошкільний вік'),
('SB-2025-0065', 'Книга 65', 'Автор 65', 'Опис книги 65', 'Фентезі, підлітковий вік'),
('SB-2025-0066', 'Книга 66', 'Автор 66', 'Опис книги 66', 'Детектив, середній вік'),
('SB-2025-0067', 'Книга 67', 'Автор 67', 'Опис книги 67', 'Психологія і саморозвиток'),
('SB-2025-0068', 'Книга 68', 'Автор 68', 'Опис книги 68', 'Казки, дошкільний вік'),
('SB-2025-0069', 'Книга 69', 'Автор 69', 'Опис книги 69', 'Фентезі, підлітковий вік'),
('SB-2025-0070', 'Книга 70', 'Автор 70', 'Опис книги 70', 'Детектив, середній вік'),
('SB-2025-0071', 'Книга 71', 'Автор 71', 'Опис книги 71', 'Пізнавальні, середній вік'),
('SB-2025-0072', 'Книга 72', 'Автор 72', 'Опис книги 72', 'Сучасна проза'),
('SB-2025-0073', 'Книга 73', 'Автор 73', 'Опис книги 73', 'Пригоди, молодший вік'),
('SB-2025-0074', 'Книга 74', 'Автор 74', 'Опис книги 74', 'Казки, дошкільний вік'),
('SB-2025-0075', 'Книга 75', 'Автор 75', 'Опис книги 75', 'Фентезі, підлітковий вік'),
('SB-2025-0076', 'Книга 76', 'Автор 76', 'Опис книги 76', 'Детектив, середній вік'),
('SB-2025-0077', 'Книга 77', 'Автор 77', 'Опис книги 77', 'Психологія і саморозвиток'),
('SB-2025-0078', 'Книга 78', 'Автор 78', 'Опис книги 78', 'Казки, дошкільний вік'),
('SB-2025-0079', 'Книга 79', 'Автор 79', 'Опис книги 79', 'Фентезі, підлітковий вік'),
('SB-2025-0080', 'Книга 80', 'Автор 80', 'Опис книги 80', 'Детектив, середній вік'),
('SB-2025-0081', 'Книга 81', 'Автор 81', 'Опис книги 81', 'Пізнавальні, середній вік'),
('SB-2025-0082', 'Книга 82', 'Автор 82', 'Опис книги 82', 'Сучасна проза'),
('SB-2025-0083', 'Книга 83', 'Автор 83', 'Опис книги 83', 'Пригоди, молодший вік'),
('SB-2025-0084', 'Книга 84', 'Автор 84', 'Опис книги 84', 'Казки, дошкільний вік'),
('SB-2025-0085', 'Книга 85', 'Автор 85', 'Опис книги 85', 'Фентезі, підлітковий вік'),
('SB-2025-0086', 'Книга 86', 'Автор 86', 'Опис книги 86', 'Детектив, середній вік'),
('SB-2025-0087', 'Книга 87', 'Автор 87', 'Опис книги 87', 'Психологія і саморозвиток'),
('SB-2025-0088', 'Книга 88', 'Автор 88', 'Опис книги 88', 'Казки, дошкільний вік'),
('SB-2025-0089', 'Книга 89', 'Автор 89', 'Опис книги 89', 'Фентезі, підлітковий вік'),
('SB-2025-0090', 'Книга 90', 'Автор 90', 'Опис книги 90', 'Детектив, середній вік'),
('SB-2025-0091', 'Книга 91', 'Автор 91', 'Опис книги 91', 'Пізнавальні, середній вік'),
('SB-2025-0092', 'Книга 92', 'Автор 92', 'Опис книги 92', 'Сучасна проза'),
('SB-2025-0093', 'Книга 93', 'Автор 93', 'Опис книги 93', 'Пригоди, молодший вік'),
('SB-2025-0094', 'Книга 94', 'Автор 94', 'Опис книги 94', 'Казки, дошкільний вік'),
('SB-2025-0095', 'Книга 95', 'Автор 95', 'Опис книги 95', 'Фентезі, підлітковий вік'),
('SB-2025-0096', 'Книга 96', 'Автор 96', 'Опис книги 96', 'Детектив, середній вік'),
('SB-2025-0097', 'Книга 97', 'Автор 97', 'Опис книги 97', 'Психологія і саморозвиток'),
('SB-2025-0098', 'Книга 98', 'Автор 98', 'Опис книги 98', 'Казки, дошкільний вік'),
('SB-2025-0099', 'Книга 99', 'Автор 99', 'Опис книги 99', 'Фентезі, підлітковий вік'),
('SB-2025-0100', 'Книга 100', 'Автор 100', 'Опис книги 100', 'Детектив, середній вік'),
('SB-2025-0101', 'Книга 101', 'Автор 101', 'Опис книги 101', 'Пізнавальні, середній вік'),
('SB-2025-0102', 'Книга 102', 'Автор 102', 'Опис книги 102', 'Сучасна проза'),
('SB-2025-0103', 'Книга 103', 'Автор 103', 'Опис книги 103', 'Пригоди, молодший вік'),
('SB-2025-0104', 'Книга 104', 'Автор 104', 'Опис книги 104', 'Казки, дошкільний вік'),
('SB-2025-0105', 'Книга 105', 'Автор 105', 'Опис книги 105', 'Фентезі, підлітковий вік');

-- Обновляем книги с правильными названиями
UPDATE public.books 
SET 
    title = cb.title,
    author = cb.author,
    description = cb.description,
    category_id = find_category_by_parts(cb.category),
    updated_at = NOW()
FROM correct_books cb
WHERE public.books.code = cb.code;

-- Проверяем результат
SELECT 
    'Названия книг обновлены!' as status,
    COUNT(*) as total_books,
    COUNT(CASE WHEN title NOT LIKE 'Книга %' THEN 1 END) as books_with_real_titles,
    COUNT(CASE WHEN title LIKE 'Книга %' THEN 1 END) as books_with_placeholder_titles
FROM public.books;

-- Показываем обновленные книги
SELECT 
    title,
    author,
    code,
    available
FROM public.books
WHERE title NOT LIKE 'Книга %'
ORDER BY code
LIMIT 30;
