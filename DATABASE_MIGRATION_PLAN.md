# –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∫ PRO-—É—Ä–æ–≤–Ω—é

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã:
- **books** (106 –∑–∞–ø–∏—Å–µ–π) - –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∫–Ω–∏–≥
- **categories** (18 –∑–∞–ø–∏—Å–µ–π) - –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –∏–µ—Ä–∞—Ä—Ö–∏–µ–π
- **users** (0 –∑–∞–ø–∏—Å–µ–π) - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- **subscription_requests** (0 –∑–∞–ø–∏—Å–µ–π) - –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É
- **rentals** (0 –∑–∞–ø–∏—Å–µ–π) - –∞—Ä–µ–Ω–¥–∞ –∫–Ω–∏–≥
- **payments** (0 –∑–∞–ø–∏—Å–µ–π) - –ø–ª–∞—Ç–µ–∂–∏

### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
1. **–ù–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–≤—Ç–æ—Ä–æ–≤** - –∞–≤—Ç–æ—Ä—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ —Ç–µ–∫—Å—Ç –≤ books.author
2. **–ù–µ—Ç —Å–≤—è–∑–∏ books ‚Üî categories** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ category
3. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –ø–æ–¥–ø–∏—Å–æ–∫** (plans, subscriptions)
4. **–ù–µ—Ç —Ç–∞–±–ª–∏—Ü –¥–ª—è Telegram-–±–æ—Ç–∞**
5. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç RLS –ø–æ–ª–∏—Ç–∏–∫–∏**
6. **–ù–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π PostgreSQL** (pg_trgm, unaccent)
7. **–ù–µ—Ç FTS –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞**

## üéØ –¶–µ–ª–µ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (Blueprint v2)

### 1. –†–∞—Å—à–∏—Ä–µ–Ω–∏—è PostgreSQL
```sql
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "pg_trgm";
CREATE EXTENSION IF NOT EXISTS "unaccent";
-- CREATE EXTENSION IF NOT EXISTS "vector"; -- –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
```

### 2. –ò–µ—Ä–∞—Ä—Ö–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
```sql
-- main_categories (–≥–ª–∞–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
-- subcategories (–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
-- books.subcategory_id ‚Üí subcategories.id ‚Üí main_categories.id
```

### 3. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ—Ä–æ–≤
```sql
-- authors (—Ç–∞–±–ª–∏—Ü–∞ –∞–≤—Ç–æ—Ä–æ–≤)
-- book_authors (—Å–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º)
-- books.author_text (–¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–≤–æ–¥–∞)
```

### 4. –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫
```sql
-- plans (–ø–ª–∞–Ω—ã –ø–æ–¥–ø–∏—Å–∫–∏)
-- profiles (–ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
-- subscriptions (–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏)
```

### 5. Telegram-–±–æ—Ç
```sql
-- bot_users (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–æ—Ç–∞)
-- bot_admins (–∞–¥–º–∏–Ω—ã –±–æ—Ç–∞)
-- bot_settings (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
-- notification_queue (–æ—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
```

### 6. –ü–æ–∏—Å–∫ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
```sql
-- search_queries (–∂—É—Ä–Ω–∞–ª –ø–æ–∏—Å–∫–∞)
-- book_embeddings (–≤–µ–∫—Ç–æ—Ä–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
-- FTS search_vector –≤ books
```

## üìã –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ (–ø–æ—ç—Ç–∞–ø–Ω–æ)

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è PostgreSQL
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é touch_updated_at()
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é books_tsvector() –¥–ª—è FTS

### –≠—Ç–∞–ø 2: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- [ ] –°–æ–∑–¥–∞—Ç—å main_categories
- [ ] –°–æ–∑–¥–∞—Ç—å subcategories
- [ ] –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ categories
- [ ] –û–±–Ω–æ–≤–∏—Ç—å books.subcategory_id

### –≠—Ç–∞–ø 3: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ—Ä–æ–≤
- [ ] –°–æ–∑–¥–∞—Ç—å authors
- [ ] –°–æ–∑–¥–∞—Ç—å book_authors
- [ ] –ò–∑–≤–ª–µ—á—å –∞–≤—Ç–æ—Ä–æ–≤ –∏–∑ books.author
- [ ] –î–æ–±–∞–≤–∏—Ç—å books.author_text

### –≠—Ç–∞–ø 4: –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫
- [ ] –°–æ–∑–¥–∞—Ç—å plans
- [ ] –°–æ–∑–¥–∞—Ç—å profiles
- [ ] –°–æ–∑–¥–∞—Ç—å subscriptions
- [ ] –û–±–Ω–æ–≤–∏—Ç—å subscription_requests

### –≠—Ç–∞–ø 5: Telegram-–±–æ—Ç
- [ ] –°–æ–∑–¥–∞—Ç—å bot_users
- [ ] –°–æ–∑–¥–∞—Ç—å bot_admins
- [ ] –°–æ–∑–¥–∞—Ç—å bot_settings
- [ ] –°–æ–∑–¥–∞—Ç—å notification_queue

### –≠—Ç–∞–ø 6: –ü–æ–∏—Å–∫ –∏ –∏–Ω–¥–µ–∫—Å—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å search_vector –≤ books
- [ ] –°–æ–∑–¥–∞—Ç—å FTS –∏–Ω–¥–µ–∫—Å—ã
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∏–≥—Ä–∞–º–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
- [ ] –°–æ–∑–¥–∞—Ç—å RPC —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞

### –≠—Ç–∞–ø 7: RLS –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- [ ] –í–∫–ª—é—á–∏—Ç—å RLS –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
- [ ] –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ "deny-by-default"
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∫–∞—Ç–∞–ª–æ–≥—É
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ—Å—Ç—É–ø –¥–ª—è staff/admin

### –≠—Ç–∞–ø 8: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–≤—è–∑–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã
- [ ] –°–æ–∑–¥–∞—Ç—å views –¥–ª—è API

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∑–∞–ø—É—Å–∫—É

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–∞ –∫:
- ‚úÖ –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º—É –∫–∞—Ç–∞–ª–æ–≥—É –∫–Ω–∏–≥
- ‚úÖ –°–∏—Å—Ç–µ–º–µ –ø–æ–¥–ø–∏—Å–æ–∫ –∏ –∞—Ä–µ–Ω–¥—ã
- ‚úÖ Telegram-–±–æ—Ç—É
- ‚úÖ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–º—É –ø–æ–∏—Å–∫—É
- ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–µ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: FTS + –∏–Ω–¥–µ–∫—Å—ã —É—Å–∫–æ—Ä—è—Ç –ø–æ–∏—Å–∫ –≤ 10+ —Ä–∞–∑
2. **–ì–∏–±–∫–æ—Å—Ç—å**: –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª–∏—Ç –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: RLS –∑–∞—â–∏—Ç–∏—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–æ—Å—Ç—É –¥–æ 100k+ –∫–Ω–∏–≥
5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**: –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ Telegram-–±–æ—Ç—É –∏ –≤–Ω–µ—à–Ω–∏–º API
